/* src/flows/magic/styles/MagicFlowSvg.module.css */

.svgRoot {
  width: 100%;
  max-width: 1100px;
  height: auto;
  padding-top: 10px;
}

/* ノード（User / Frontend / API / DB / Mail / TokenStore / App） */

.nodeRect {
  fill: #1f1a2e; /* ダークパープル */
  stroke: #7c3aed; /* 薄い紫 */
  stroke-width: 1.5;
}

.arrowLabel {
  fill: #9ca3af; /* 中間のグレー */
  font-size: 10px;
  text-anchor: middle;
  dominant-baseline: middle;
}

.nodeLabel {
  fill: #e5e7eb; /* 明るいグレー */
  font-size: 12px;
  text-anchor: middle;
  dominant-baseline: middle;
}

.nodeLabelSmall {
  fill: #9ca3af;
  font-size: 9px;
  text-anchor: middle;
  dominant-baseline: middle;
}

/* Lifeline（縦線） */

.lifeline {
  stroke: #4b5563;
  stroke-dasharray: 4 4;
  stroke-width: 1;
  opacity: 1;
}

/* 矢印関連 */

.arrowGroup {
  opacity: 0.4;
  transition: opacity 0.25s ease, transform 0.25s ease;
}

.arrow {
  stroke: #7c3aed;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: stroke-width 0.25s ease, stroke 0.25s ease;
}

.arrowHead {
  fill: #7c3aed;
  transition: fill 0.25s ease;
}

/* ========================= */
/* 一方向アニメーション      */
/* ========================= */

/* ---- 右向き（→）に流れる ---- */
@keyframes arrowFlowRight {
  from {
    stroke-dashoffset: 0;
  }
  to {
    stroke-dashoffset: -120;
  }
}

.arrowRightActive {
  opacity: 1;
  transform: translateY(0px);
}

.arrowRightActive .arrow,
.arrowRightActive .arrowDashed {
  stroke: #c4b5fd;
  stroke-width: 3;
  stroke-dasharray: 8 4;
  animation: arrowFlowRight 5s linear infinite;
  filter: drop-shadow(0 0 6px #c084fc);
}

.arrowRightActive .arrowHead {
  fill: #c4b5fd;
}

/* ---- 左向き（←）に流れる ---- */
@keyframes arrowFlowLeft {
  from {
    stroke-dashoffset: 120;
  }
  to {
    stroke-dashoffset: 0;
  }
}

.arrowLeftActive {
  opacity: 1;
  transform: translateY(0px);
}

.arrowLeftActive .arrow,
.arrowLeftActive .arrowDashed {
  stroke: #c4b5fd;
  stroke-width: 3;
  stroke-dasharray: 8 4;
  animation: arrowFlowLeft 5s linear infinite;
  filter: drop-shadow(0 0 6px #c084fc);
}

.arrowLeftActive .arrowHead {
  fill: #c4b5fd;
}

/*------------------------------*/

/* ステップ番号の丸 */

.stepGroup {
  opacity: 0.6;
  transform-origin: center;
  transform-box: fill-box;
  transition: opacity 0.25s ease, transform 0.25s ease, filter 0.25s ease;
}

.stepGroupActive {
  opacity: 1;
  transform: scale(1.15);
  filter: drop-shadow(0 0 8px rgba(196, 181, 253, 0.9));
}

.stepCircle {
  fill: #020617; /* ほぼ黒に近い背景 */
  stroke: #7c3aed;
  stroke-width: 1.5;
}

.stepLabel {
  fill: #e5e7eb;
  font-size: 10px;
  font-weight: 600;
  text-anchor: middle;
  dominant-baseline: middle;
}

/* ノート（説明ボックス） */

.noteRect {
  fill: #1e293b;
  stroke: #475569;
  stroke-width: 1;
  rx: 4;
  ry: 4;
}

.noteLabel {
  fill: #94a3b8;
  font-size: 9px;
  text-anchor: middle;
  dominant-baseline: middle;
}

/* 条件分岐（alt） */

.altRect {
  fill: none;
  stroke: #6366f1;
  stroke-width: 1;
  stroke-dasharray: 4 2;
}

.altLabel {
  fill: #818cf8;
  font-size: 9px;
  font-weight: 600;
  text-anchor: start;
  dominant-baseline: middle;
}

.altDivider {
  stroke: #6366f1;
  stroke-width: 1;
  stroke-dasharray: 4 2;
}

/* ================================================= */
/* ループアニメーション（自己参照用）                */
/* ================================================= */

@keyframes arrowFlowRightLoop {
  from {
    stroke-dashoffset: 0;
  }
  to {
    stroke-dashoffset: -140;
  }
}

.arrowLoopActive {
  opacity: 1;
  transform: translateY(0px);
}

.arrowLoopActive .arrow,
.arrowLoopActive .arrowDashed {
  stroke-dasharray: 10 6;
  animation: arrowFlowRightLoop 5s linear infinite;
  stroke: #c4b5fd;
  stroke-width: 3;
  filter: drop-shadow(0 0 6px #c084fc);
}

.arrowLoopActive .arrowHead {
  fill: #c4b5fd;
}

/* ================================================= */
/* 双方向ループアニメーション（内部処理用）          */
/* ================================================= */

/* 上段：右向き（→）に流れる線（矢印なし） */
.arrowLoopUp {
  opacity: 1;
  transform: translateY(0px);
}

.arrowLoopUp .arrow,
.arrowLoopUp .arrowDashed {
  stroke-dasharray: 10 6;
  animation: arrowFlowRightLoop 5s linear infinite;
  stroke: #c4b5fd;
  stroke-width: 3;
  filter: drop-shadow(0 0 6px #c084fc);
}

.arrowLoopUp .arrowHead {
  fill: #c4b5fd;
}

/* 下段：左向き（←）に流れる線（矢印付き） */
@keyframes arrowFlowLeftLoop {
  from {
    stroke-dashoffset: 0;
  }
  to {
    stroke-dashoffset: 140;
  }
}

.arrowLoopDown {
  opacity: 1;
  transform: translateY(0px);
}

.arrowLoopDown .arrow,
.arrowLoopDown .arrowDashed {
  stroke: #c4b5fd;
  stroke-width: 3;
  filter: drop-shadow(0 0 6px #c084fc);
  stroke-dasharray: 10 6;
  animation: arrowFlowLeftLoop 5s linear infinite;
}

.arrowLoopDown .arrowHead {
  fill: #c4b5fd;
}

/* ================================================= */
/* クリック可能なステップノード                      */
/* ================================================= */

.clickable {
  cursor: pointer;
  outline: none;
}

.clickable:hover .stepCircle {
  stroke: #a78bfa;
  stroke-width: 2.5;
  filter: drop-shadow(0 0 6px rgba(167, 139, 250, 0.6));
}

.clickable:focus-visible .stepCircle {
  stroke: #c4b5fd;
  stroke-width: 3;
  filter: drop-shadow(0 0 8px rgba(196, 181, 253, 0.8));
}

.clickable:active {
  opacity: 0.8;
}
